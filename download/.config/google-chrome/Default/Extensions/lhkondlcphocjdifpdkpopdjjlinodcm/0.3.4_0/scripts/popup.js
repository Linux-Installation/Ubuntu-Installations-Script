"use strict";var _createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var i=a[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(a,t,i){return t&&e(a.prototype,t),i&&e(a,i),a}}();function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var AffiliateIdsHandler=function(){function e(a){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,e),this._chrome=a,this._loadCallback=i,this._chrome.runtime.onStartup.addListener(function(){t.loadDatabase()}),this._chrome.storage.onChanged.addListener(function(e,a){t.loadDatabase()}),this.loadDatabase()}return _createClass(e,[{key:"setupLoadCallback",value:function(e){this._loadCallback=e}},{key:"loadDatabase",value:function(){var e=this;this._chrome.storage.sync.get("runtime",function(a){a.runtime&&(e._runtime=a.runtime),e._loadCallback&&e._loadCallback(e)})}},{key:"getAffiliateIds",value:function(e){return this._runtime?this._runtime[e].ids:[]}},{key:"removeAffiliateId",value:function(e,a){for(var t=0;t<this._runtime[e].ids.length;t++)this._runtime[e].ids[t].id==a&&(this._runtime[e].ids.splice(t,1),this._saveState())}},{key:"addAffiliateId",value:function(e,a,t){if(""==a.replace(/\s/g,""))return 1;if(""==t.replace(/\s/g,""))return 2;if(this.isConfiguredId(e,t))return 2;if(-1==t.indexOf("-"))return 2;var i={name:a,id:t=t.replace(/\s/g,"")};return this._runtime[e].ids.push(i),this._saveState(),0}},{key:"isConfiguredId",value:function(e,a){for(var t=0;t<this._runtime[e].ids.length;t++)if(this._runtime[e].ids[t].id==a)return!0;return!1}},{key:"setPreventOverwrite",value:function(e){return this._runtime.config={prevent:!!e},this._saveState(),!!e}},{key:"getPreventOverwrite",value:function(){return!!this._runtime&&(!!this._runtime.config&&(!!this._runtime.config.prevent&&this._runtime.config.prevent))}},{key:"_saveState",value:function(){this._chrome.storage.sync.set({runtime:this._runtime})}}]),e}(),OptionsMenu=function(){function e(a){_classCallCheck(this,e),this._affiliateIdsHandler=a,this._affiliateIdsHandler.loadDatabase(),this._affiliateIdsHandler.setupLoadCallback(this._renderTable),this.showCountryConfiguration(this.getCountryCode()),this.setupClickHandler()}return _createClass(e,[{key:"clickHandler",value:function(e){var a=this.getCountryCode();if(!$("#"+a+" .input-field #name").hasClass("invalid")&&!$("#"+a+" .input-field #Affiliate_Id").hasClass("invalid")){$("#"+a+" .input-field #name").removeClass("invalid"),$("#"+a+" .input-field #Affiliate_Id").removeClass("invalid"),$("#"+a+" .input-field #name").removeClass("valid"),$("#"+a+" .input-field #Affiliate_Id").removeClass("valid");var t=$("#"+a+" .input-field #name").val(),i=$("#"+a+" .input-field #Affiliate_Id").val();switch(this._affiliateIdsHandler.addAffiliateId(a,t,i)){case 1:$("#"+a+" .input-field #name").addClass("invalid");break;case 2:$("#"+a+" .input-field #Affiliate_Id").addClass("invalid");break;default:$("#"+a+" .input-field #name").val(""),$("#"+a+" .input-field #Affiliate_Id").val("")}$("#"+a+" .input-field #name").focus()}}},{key:"showCountryConfiguration",value:function(a){var t=$("#templates .card").clone(),i=t.find(".jumptolink");i.attr("href",e.associatePrograms[a].url),i.text(i.text().replace("###AMAZONNAME###",e.associatePrograms[a].name)),$("#"+a).empty(),$("#"+a).append(t),$("#"+a+" .input-field #name").focus(),this._renderTable(this._affiliateIdsHandler,a),this.setupClickHandler()}},{key:"getCountryCode",value:function(){return $(".tabs a.active").attr("href").replace("#","")}},{key:"setupClickHandler",value:function(){var e=this;$(".tab a").unbind("click"),$(".tab a").click(function(a){var t=a.currentTarget.hash.replace("#","");e.showCountryConfiguration(t)}),$(document).unbind("keypress"),$(document).keypress(function(a){"13"==(a.keyCode||a.which)&&e.clickHandler($(".insert-new-affiliate-id"))}),$(".insert-new-affiliate-id").unbind("click"),$(".insert-new-affiliate-id").click(function(a){e.clickHandler(a.currentTarget)}),$("#Override_Tag_Cb").unbind("click"),$("#Override_Tag_Cb").click(function(a){e._affiliateIdsHandler.setPreventOverwrite($("#Override_Tag").prop("checked"))})}},{key:"_renderTable",value:function(a,t){var i=$(".tabs a.active").attr("href").replace("#","");t&&(i=t);var n=a.getAffiliateIds(i);$("#"+i+" .card .card-content .affiliate-list .table-content").empty(),n.forEach(function(t){var n=$("#templates .table-entry").clone();n.children(".affiliate-name").text(t.name),n.children(".affiliate-id").text(t.id),n.find(".affiliate-jump-to-amazon a").attr("href",e.associatePrograms[i].url+"/?tag="+t.id),$("#"+i+" .card .card-content .affiliate-list .table-content").append(n),$(n).find(".affiliate-remove").click(function(e){a.removeAffiliateId(i,$(e.currentTarget).parent().find(".affiliate-id").text())})});var r=!!a.getPreventOverwrite();$("#Override_Tag").prop("checked",r)}}]),e}();OptionsMenu.associatePrograms={de:{name:"www.amazon.de",url:"https://www.amazon.de"},uk:{name:"www.amazon.co.uk",url:"https://www.amazon.co.uk"},us:{name:"www.amazon.com",url:"https://www.amazon.com"},fr:{name:"www.amazon.fr",url:"https://www.amazon.fr"},jp:{name:"www.amazon.co.jp",url:"https://www.amazon.co.jp"},ca:{name:"www.amazon.ca",url:"https://www.amazon.ca"},cn:{name:"www.amazon.cn",url:"https://www.amazon.cn"},it:{name:"www.amazon.it",url:"https://www.amazon.it"},es:{name:"www.amazon.es",url:"https://www.amazon.es"},in:{name:"www.amazon.in",url:"https://www.amazon.in"},br:{name:"www.amazon.com.br",url:"https://www.amazon.com.br"}},$(function(){new OptionsMenu(new AffiliateIdsHandler(chrome))});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdHMvcG9wdXAuanMiXSwibmFtZXMiOlsiX2NyZWF0ZUNsYXNzIiwiZGVmaW5lUHJvcGVydGllcyIsInRhcmdldCIsInByb3BzIiwiaSIsImxlbmd0aCIsImRlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImtleSIsIkNvbnN0cnVjdG9yIiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwicHJvdG90eXBlIiwiX2NsYXNzQ2FsbENoZWNrIiwiaW5zdGFuY2UiLCJUeXBlRXJyb3IiLCJBZmZpbGlhdGVJZHNIYW5kbGVyIiwiY2hyb21lIiwiX3RoaXMiLCJ0aGlzIiwibG9hZENhbGxiYWNrIiwiYXJndW1lbnRzIiwidW5kZWZpbmVkIiwiX2Nocm9tZSIsIl9sb2FkQ2FsbGJhY2siLCJydW50aW1lIiwib25TdGFydHVwIiwiYWRkTGlzdGVuZXIiLCJsb2FkRGF0YWJhc2UiLCJzdG9yYWdlIiwib25DaGFuZ2VkIiwiY2hhbmdlcyIsIm5hbWVzcGFjZSIsInZhbHVlIiwiX3RoaXMyIiwic3luYyIsImdldCIsImRhdGEiLCJfcnVudGltZSIsImNvdW50cnlDb2RlIiwiaWRzIiwiaWQiLCJzcGxpY2UiLCJfc2F2ZVN0YXRlIiwibmFtZSIsImFmZmlhdGVJZCIsInJlcGxhY2UiLCJpc0NvbmZpZ3VyZWRJZCIsImluZGV4T2YiLCJhZmZpbGlhdGVJZE9iamVjdCIsInB1c2giLCJhZmZpbGlhdGVJZCIsInByZXZlbnQiLCJjb25maWciLCJzZXQiLCJPcHRpb25zTWVudSIsImFmZmlsaWF0ZUlkc0hhbmRsZXIiLCJfYWZmaWxpYXRlSWRzSGFuZGxlciIsInNldHVwTG9hZENhbGxiYWNrIiwiX3JlbmRlclRhYmxlIiwic2hvd0NvdW50cnlDb25maWd1cmF0aW9uIiwiZ2V0Q291bnRyeUNvZGUiLCJzZXR1cENsaWNrSGFuZGxlciIsImVsZW1lbnQiLCIkIiwiaGFzQ2xhc3MiLCJyZW1vdmVDbGFzcyIsInZhbCIsImFkZEFmZmlsaWF0ZUlkIiwiYWRkQ2xhc3MiLCJmb2N1cyIsImNvdW50cnlDYXJkIiwiY2xvbmUiLCJqdW1wVG9MaW5rIiwiZmluZCIsImF0dHIiLCJhc3NvY2lhdGVQcm9ncmFtcyIsInVybCIsInRleHQiLCJlbXB0eSIsImFwcGVuZCIsIl90aGlzMyIsInVuYmluZCIsImNsaWNrIiwiZSIsImN1cnJlbnRUYXJnZXQiLCJoYXNoIiwiZG9jdW1lbnQiLCJrZXlwcmVzcyIsImV2ZW50Iiwia2V5Q29kZSIsIndoaWNoIiwiY2xpY2tIYW5kbGVyIiwic2V0UHJldmVudE92ZXJ3cml0ZSIsInByb3AiLCJjb3VudHJ5Q29kZUdpdmVuIiwiYWZmaWxpYXRlSWRzIiwiZ2V0QWZmaWxpYXRlSWRzIiwiZm9yRWFjaCIsInRhYmxlX2VudHJ5IiwiY2hpbGRyZW4iLCJyZW1vdmVBZmZpbGlhdGVJZCIsInBhcmVudCIsImdldFByZXZlbnRPdmVyd3JpdGUiLCJkZSIsInVrIiwidXMiLCJmciIsImpwIiwiY2EiLCJjbiIsIml0IiwiZXMiLCJpbiIsImJyIl0sIm1hcHBpbmdzIjoiQUFBQSxhQUVBLElBQUlBLGFBQWUsV0FBYyxTQUFTQyxFQUFpQkMsRUFBUUMsR0FBUyxJQUFLLElBQUlDLEVBQUksRUFBR0EsRUFBSUQsRUFBTUUsT0FBUUQsSUFBSyxDQUFFLElBQUlFLEVBQWFILEVBQU1DLEdBQUlFLEVBQVdDLFdBQWFELEVBQVdDLGFBQWMsRUFBT0QsRUFBV0UsY0FBZSxFQUFVLFVBQVdGLElBQVlBLEVBQVdHLFVBQVcsR0FBTUMsT0FBT0MsZUFBZVQsRUFBUUksRUFBV00sSUFBS04sSUFBaUIsT0FBTyxTQUFVTyxFQUFhQyxFQUFZQyxHQUFpSixPQUE5SEQsR0FBWWIsRUFBaUJZLEVBQVlHLFVBQVdGLEdBQWlCQyxHQUFhZCxFQUFpQlksRUFBYUUsR0FBcUJGLEdBQTdnQixHQUVuQixTQUFTSSxnQkFBZ0JDLEVBQVVMLEdBQWUsS0FBTUssYUFBb0JMLEdBQWdCLE1BQU0sSUFB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Iiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbnZhciBBZmZpbGlhdGVJZHNIYW5kbGVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBBZmZpbGlhdGVJZHNIYW5kbGVyKGNocm9tZSkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICB2YXIgbG9hZENhbGxiYWNrID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBudWxsO1xuXG4gICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEFmZmlsaWF0ZUlkc0hhbmRsZXIpO1xuXG4gICAgdGhpcy5fY2hyb21lID0gY2hyb21lO1xuICAgIHRoaXMuX2xvYWRDYWxsYmFjayA9IGxvYWRDYWxsYmFjaztcblxuICAgIHRoaXMuX2Nocm9tZS5ydW50aW1lLm9uU3RhcnR1cC5hZGRMaXN0ZW5lcihmdW5jdGlvbiAoKSB7XG4gICAgICBfdGhpcy5sb2FkRGF0YWJhc2UoKTtcbiAgICB9KTtcbiAgICB0aGlzLl9jaHJvbWUuc3RvcmFnZS5vbkNoYW5nZWQuYWRkTGlzdGVuZXIoZnVuY3Rpb24gKGNoYW5nZXMsIG5hbWVzcGFjZSkge1xuICAgICAgX3RoaXMubG9hZERhdGFiYXNlKCk7XG4gICAgfSk7XG4gICAgdGhpcy5sb2FkRGF0YWJhc2UoKTtcbiAgfVxuXG4gIF9jcmVhdGVDbGFzcyhBZmZpbGlhdGVJZHNIYW5kbGVyLCBbe1xuICAgIGtleTogXCJzZXR1cExvYWRDYWxsYmFja1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBzZXR1cExvYWRDYWxsYmFjayhsb2FkQ2FsbGJhY2spIHtcbiAgICAgIHRoaXMuX2xvYWRDYWxsYmFjayA9IGxvYWRDYWxsYmFjaztcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwibG9hZERhdGFiYXNlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGxvYWREYXRhYmFzZSgpIHtcbiAgICAgIHZhciBfdGhpczIgPSB0aGlzO1xuXG4gICAgICB0aGlzLl9jaHJvbWUuc3RvcmFnZS5zeW5jLmdldCgncnVudGltZScsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIGlmIChkYXRhLnJ1bnRpbWUpIF90aGlzMi5fcnVudGltZSA9IGRhdGEucnVudGltZTtcbiAgICAgICAgaWYgKF90aGlzMi5fbG9hZENhbGxiYWNrKSBfdGhpczIuX2xvYWRDYWxsYmFjayhfdGhpczIpO1xuICAgICAgfSk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImdldEFmZmlsaWF0ZUlkc1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRBZmZpbGlhdGVJZHMoY291bnRyeUNvZGUpIHtcbiAgICAgIGlmICh0aGlzLl9ydW50aW1lKSByZXR1cm4gdGhpcy5fcnVudGltZVtjb3VudHJ5Q29kZV0uaWRzO2Vsc2UgcmV0dXJuIFtdO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJyZW1vdmVBZmZpbGlhdGVJZFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVBZmZpbGlhdGVJZChjb3VudHJ5Q29kZSwgaWQpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5fcnVudGltZVtjb3VudHJ5Q29kZV0uaWRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmICh0aGlzLl9ydW50aW1lW2NvdW50cnlDb2RlXS5pZHNbaV0uaWQgPT0gaWQpIHtcbiAgICAgICAgICB0aGlzLl9ydW50aW1lW2NvdW50cnlDb2RlXS5pZHMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgIHRoaXMuX3NhdmVTdGF0ZSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImFkZEFmZmlsaWF0ZUlkXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGFkZEFmZmlsaWF0ZUlkKGNvdW50cnlDb2RlLCBuYW1lLCBhZmZpYXRlSWQpIHtcbiAgICAgIC8qKlxuICAgICAgICogc29tZSB2YWxpZGF0aW9uXG4gICAgICAgKi9cbiAgICAgIGlmIChuYW1lLnJlcGxhY2UoL1xccy9nLCBcIlwiKSA9PSBcIlwiKSByZXR1cm4gMTtcbiAgICAgIGlmIChhZmZpYXRlSWQucmVwbGFjZSgvXFxzL2csIFwiXCIpID09IFwiXCIpIHJldHVybiAyO1xuICAgICAgaWYgKHRoaXMuaXNDb25maWd1cmVkSWQoY291bnRyeUNvZGUsIGFmZmlhdGVJZCkpIHJldHVybiAyO1xuICAgICAgLyoqXG4gICAgICAgKiBBZmZpbGF0ZSBJRHMgaGF2ZSB0byBjb250YWluIGEgLVxuICAgICAgICovXG4gICAgICBpZiAoYWZmaWF0ZUlkLmluZGV4T2YoXCItXCIpID09IC0xKSByZXR1cm4gMjtcbiAgICAgIC8qKlxuICAgICAgICogTm8gd2hpdGVzcGFjZSBhbGxvd2VkIGluIGFmZmlsaWF0ZS1pZFxuICAgICAgICovXG4gICAgICBhZmZpYXRlSWQgPSBhZmZpYXRlSWQucmVwbGFjZSgvXFxzL2csICcnKTtcblxuICAgICAgdmFyIGFmZmlsaWF0ZUlkT2JqZWN0ID0ge1xuICAgICAgICAnbmFtZSc6IG5hbWUsXG4gICAgICAgICdpZCc6IGFmZmlhdGVJZFxuICAgICAgfTtcbiAgICAgIHRoaXMuX3J1bnRpbWVbY291bnRyeUNvZGVdLmlkcy5wdXNoKGFmZmlsaWF0ZUlkT2JqZWN0KTtcbiAgICAgIHRoaXMuX3NhdmVTdGF0ZSgpO1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImlzQ29uZmlndXJlZElkXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGlzQ29uZmlndXJlZElkKGNvdW50cnlDb2RlLCBhZmZpbGlhdGVJZCkge1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLl9ydW50aW1lW2NvdW50cnlDb2RlXS5pZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWVbY291bnRyeUNvZGVdLmlkc1tpXS5pZCA9PSBhZmZpbGlhdGVJZCkgcmV0dXJuIHRydWU7XG4gICAgICB9cmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJzZXRQcmV2ZW50T3ZlcndyaXRlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHNldFByZXZlbnRPdmVyd3JpdGUocHJldmVudCkge1xuICAgICAgdGhpcy5fcnVudGltZS5jb25maWcgPSB7XG4gICAgICAgICdwcmV2ZW50JzogcHJldmVudCA/IHRydWUgOiBmYWxzZVxuICAgICAgfTtcblxuICAgICAgdGhpcy5fc2F2ZVN0YXRlKCk7XG4gICAgICByZXR1cm4gcHJldmVudCA/IHRydWUgOiBmYWxzZTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiZ2V0UHJldmVudE92ZXJ3cml0ZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRQcmV2ZW50T3ZlcndyaXRlKCkge1xuICAgICAgaWYgKHRoaXMuX3J1bnRpbWUpXG4gICAgICAgIC8vcmV0dXJuIHRoaXMuX3J1bnRpbWUuY29uZmlnPy5wcmV2ZW50ID8gdGhpcy5fcnVudGltZS5jb25maWcucHJldmVudCA6IGZhbHNlO1xuICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5jb25maWcgPyB0aGlzLl9ydW50aW1lLmNvbmZpZy5wcmV2ZW50ID8gdGhpcy5fcnVudGltZS5jb25maWcucHJldmVudCA6IGZhbHNlIDogZmFsc2U7ZWxzZSByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcIl9zYXZlU3RhdGVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gX3NhdmVTdGF0ZSgpIHtcbiAgICAgIHRoaXMuX2Nocm9tZS5zdG9yYWdlLnN5bmMuc2V0KHsgJ3J1bnRpbWUnOiB0aGlzLl9ydW50aW1lIH0pO1xuICAgIH1cbiAgfV0pO1xuXG4gIHJldHVybiBBZmZpbGlhdGVJZHNIYW5kbGVyO1xufSgpO1xuXG52YXIgT3B0aW9uc01lbnUgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIE9wdGlvbnNNZW51KGFmZmlsaWF0ZUlkc0hhbmRsZXIpIHtcbiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgT3B0aW9uc01lbnUpO1xuXG4gICAgdGhpcy5fYWZmaWxpYXRlSWRzSGFuZGxlciA9IGFmZmlsaWF0ZUlkc0hhbmRsZXI7XG4gICAgdGhpcy5fYWZmaWxpYXRlSWRzSGFuZGxlci5sb2FkRGF0YWJhc2UoKTtcbiAgICB0aGlzLl9hZmZpbGlhdGVJZHNIYW5kbGVyLnNldHVwTG9hZENhbGxiYWNrKHRoaXMuX3JlbmRlclRhYmxlKTtcbiAgICB0aGlzLnNob3dDb3VudHJ5Q29uZmlndXJhdGlvbih0aGlzLmdldENvdW50cnlDb2RlKCkpO1xuICAgIHRoaXMuc2V0dXBDbGlja0hhbmRsZXIoKTtcbiAgfVxuXG4gIF9jcmVhdGVDbGFzcyhPcHRpb25zTWVudSwgW3tcbiAgICBrZXk6IFwiY2xpY2tIYW5kbGVyXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGNsaWNrSGFuZGxlcihlbGVtZW50KSB7XG4gICAgICB2YXIgY291bnRyeUNvZGUgPSB0aGlzLmdldENvdW50cnlDb2RlKCk7XG4gICAgICAvKipcbiAgICAgICAqIENoZWNrIGZvciBmcm9udGVuZCB2YWxpZGF0aW9uXG4gICAgICAgKi9cbiAgICAgIGlmICgkKCcjJyArIGNvdW50cnlDb2RlICsgJyAuaW5wdXQtZmllbGQgI25hbWUnKS5oYXNDbGFzcyhcImludmFsaWRcIikgfHwgJCgnIycgKyBjb3VudHJ5Q29kZSArICcgLmlucHV0LWZpZWxkICNBZmZpbGlhdGVfSWQnKS5oYXNDbGFzcyhcImludmFsaWRcIikpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgLyoqXG4gICAgICAgKiBSZXNldCBWYWxpZGF0aW9uXG4gICAgICAgKi9cbiAgICAgICQoJyMnICsgY291bnRyeUNvZGUgKyAnIC5pbnB1dC1maWVsZCAjbmFtZScpLnJlbW92ZUNsYXNzKFwiaW52YWxpZFwiKTtcbiAgICAgICQoJyMnICsgY291bnRyeUNvZGUgKyAnIC5pbnB1dC1maWVsZCAjQWZmaWxpYXRlX0lkJykucmVtb3ZlQ2xhc3MoXCJpbnZhbGlkXCIpO1xuICAgICAgJCgnIycgKyBjb3VudHJ5Q29kZSArICcgLmlucHV0LWZpZWxkICNuYW1lJykucmVtb3ZlQ2xhc3MoXCJ2YWxpZFwiKTtcbiAgICAgICQoJyMnICsgY291bnRyeUNvZGUgKyAnIC5pbnB1dC1maWVsZCAjQWZmaWxpYXRlX0lkJykucmVtb3ZlQ2xhc3MoXCJ2YWxpZFwiKTtcblxuICAgICAgdmFyIG5hbWUgPSAkKCcjJyArIGNvdW50cnlDb2RlICsgJyAuaW5wdXQtZmllbGQgI25hbWUnKS52YWwoKTtcbiAgICAgIHZhciBhZmZpbGlhdGVJZCA9ICQoJyMnICsgY291bnRyeUNvZGUgKyAnIC5pbnB1dC1maWVsZCAjQWZmaWxpYXRlX0lkJykudmFsKCk7XG5cbiAgICAgIHN3aXRjaCAodGhpcy5fYWZmaWxpYXRlSWRzSGFuZGxlci5hZGRBZmZpbGlhdGVJZChjb3VudHJ5Q29kZSwgbmFtZSwgYWZmaWxpYXRlSWQpKSB7XG4gICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAkKCcjJyArIGNvdW50cnlDb2RlICsgJyAuaW5wdXQtZmllbGQgI25hbWUnKS5hZGRDbGFzcyhcImludmFsaWRcIik7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAkKCcjJyArIGNvdW50cnlDb2RlICsgJyAuaW5wdXQtZmllbGQgI0FmZmlsaWF0ZV9JZCcpLmFkZENsYXNzKFwiaW52YWxpZFwiKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAkKCcjJyArIGNvdW50cnlDb2RlICsgJyAuaW5wdXQtZmllbGQgI25hbWUnKS52YWwoXCJcIik7XG4gICAgICAgICAgJCgnIycgKyBjb3VudHJ5Q29kZSArICcgLmlucHV0LWZpZWxkICNBZmZpbGlhdGVfSWQnKS52YWwoXCJcIik7XG4gICAgICB9XG4gICAgICAkKCcjJyArIGNvdW50cnlDb2RlICsgJyAuaW5wdXQtZmllbGQgI25hbWUnKS5mb2N1cygpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJzaG93Q291bnRyeUNvbmZpZ3VyYXRpb25cIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gc2hvd0NvdW50cnlDb25maWd1cmF0aW9uKGNvdW50cnlDb2RlKSB7XG4gICAgICB2YXIgY291bnRyeUNhcmQgPSAkKCcjdGVtcGxhdGVzIC5jYXJkJykuY2xvbmUoKTtcbiAgICAgIHZhciBqdW1wVG9MaW5rID0gY291bnRyeUNhcmQuZmluZCgnLmp1bXB0b2xpbmsnKTtcblxuICAgICAganVtcFRvTGluay5hdHRyKCdocmVmJywgT3B0aW9uc01lbnUuYXNzb2NpYXRlUHJvZ3JhbXNbY291bnRyeUNvZGVdLnVybCk7XG4gICAgICBqdW1wVG9MaW5rLnRleHQoanVtcFRvTGluay50ZXh0KCkucmVwbGFjZShcIiMjI0FNQVpPTk5BTUUjIyNcIiwgT3B0aW9uc01lbnUuYXNzb2NpYXRlUHJvZ3JhbXNbY291bnRyeUNvZGVdLm5hbWUpKTtcbiAgICAgICQoJyMnICsgY291bnRyeUNvZGUpLmVtcHR5KCk7XG4gICAgICAkKCcjJyArIGNvdW50cnlDb2RlKS5hcHBlbmQoY291bnRyeUNhcmQpO1xuICAgICAgJCgnIycgKyBjb3VudHJ5Q29kZSArICcgLmlucHV0LWZpZWxkICNuYW1lJykuZm9jdXMoKTtcbiAgICAgIHRoaXMuX3JlbmRlclRhYmxlKHRoaXMuX2FmZmlsaWF0ZUlkc0hhbmRsZXIsIGNvdW50cnlDb2RlKTtcbiAgICAgIHRoaXMuc2V0dXBDbGlja0hhbmRsZXIoKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiZ2V0Q291bnRyeUNvZGVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q291bnRyeUNvZGUoKSB7XG4gICAgICByZXR1cm4gJCgnLnRhYnMgYS5hY3RpdmUnKS5hdHRyKCdocmVmJykucmVwbGFjZShcIiNcIiwgXCJcIik7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcInNldHVwQ2xpY2tIYW5kbGVyXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHNldHVwQ2xpY2tIYW5kbGVyKCkge1xuICAgICAgdmFyIF90aGlzMyA9IHRoaXM7XG5cbiAgICAgIC8qKlxuICAgICAgICogc2V0dXAgY2xpY2sgaGFuZGxlciBmb3IgdGFiIGNoYW5nZVxuICAgICAgICovXG4gICAgICAkKCcudGFiIGEnKS51bmJpbmQoJ2NsaWNrJyk7XG4gICAgICAkKCcudGFiIGEnKS5jbGljayhmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgY291bnRyeUNvZGUgPSBlLmN1cnJlbnRUYXJnZXQuaGFzaC5yZXBsYWNlKFwiI1wiLCBcIlwiKTtcbiAgICAgICAgX3RoaXMzLnNob3dDb3VudHJ5Q29uZmlndXJhdGlvbihjb3VudHJ5Q29kZSk7XG4gICAgICB9KTtcblxuICAgICAgJChkb2N1bWVudCkudW5iaW5kKCdrZXlwcmVzcycpO1xuICAgICAgJChkb2N1bWVudCkua2V5cHJlc3MoZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHZhciBrZXljb2RlID0gZXZlbnQua2V5Q29kZSB8fCBldmVudC53aGljaDtcbiAgICAgICAgaWYgKGtleWNvZGUgPT0gJzEzJykgX3RoaXMzLmNsaWNrSGFuZGxlcigkKCcuaW5zZXJ0LW5ldy1hZmZpbGlhdGUtaWQnKSk7XG4gICAgICB9KTtcblxuICAgICAgJCgnLmluc2VydC1uZXctYWZmaWxpYXRlLWlkJykudW5iaW5kKCdjbGljaycpO1xuICAgICAgJCgnLmluc2VydC1uZXctYWZmaWxpYXRlLWlkJykuY2xpY2soZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgX3RoaXMzLmNsaWNrSGFuZGxlcihlLmN1cnJlbnRUYXJnZXQpO1xuICAgICAgfSk7XG5cbiAgICAgICQoJyNPdmVycmlkZV9UYWdfQ2InKS51bmJpbmQoJ2NsaWNrJyk7XG4gICAgICAkKCcjT3ZlcnJpZGVfVGFnX0NiJykuY2xpY2soZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIHByZXYgPSBfdGhpczMuX2FmZmlsaWF0ZUlkc0hhbmRsZXIuc2V0UHJldmVudE92ZXJ3cml0ZSgkKCcjT3ZlcnJpZGVfVGFnJykucHJvcCgnY2hlY2tlZCcpKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJfcmVuZGVyVGFibGVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gX3JlbmRlclRhYmxlKGFmZmlsaWF0ZUlkc0hhbmRsZXIsIGNvdW50cnlDb2RlR2l2ZW4pIHtcbiAgICAgIHZhciBjb3VudHJ5Q29kZSA9ICQoJy50YWJzIGEuYWN0aXZlJykuYXR0cignaHJlZicpLnJlcGxhY2UoXCIjXCIsIFwiXCIpO1xuICAgICAgaWYgKGNvdW50cnlDb2RlR2l2ZW4pIGNvdW50cnlDb2RlID0gY291bnRyeUNvZGVHaXZlbjtcblxuICAgICAgdmFyIGFmZmlsaWF0ZUlkcyA9IGFmZmlsaWF0ZUlkc0hhbmRsZXIuZ2V0QWZmaWxpYXRlSWRzKGNvdW50cnlDb2RlKTtcblxuICAgICAgJCgnIycgKyBjb3VudHJ5Q29kZSArICcgLmNhcmQgLmNhcmQtY29udGVudCAuYWZmaWxpYXRlLWxpc3QgLnRhYmxlLWNvbnRlbnQnKS5lbXB0eSgpO1xuXG4gICAgICBhZmZpbGlhdGVJZHMuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICB2YXIgdGFibGVfZW50cnkgPSAkKCcjdGVtcGxhdGVzIC50YWJsZS1lbnRyeScpLmNsb25lKCk7XG5cbiAgICAgICAgdGFibGVfZW50cnkuY2hpbGRyZW4oJy5hZmZpbGlhdGUtbmFtZScpLnRleHQoZWxlbWVudC5uYW1lKTtcbiAgICAgICAgdGFibGVfZW50cnkuY2hpbGRyZW4oJy5hZmZpbGlhdGUtaWQnKS50ZXh0KGVsZW1lbnQuaWQpO1xuICAgICAgICB0YWJsZV9lbnRyeS5maW5kKCcuYWZmaWxpYXRlLWp1bXAtdG8tYW1hem9uIGEnKS5hdHRyKCdocmVmJywgT3B0aW9uc01lbnUuYXNzb2NpYXRlUHJvZ3JhbXNbY291bnRyeUNvZGVdLnVybCArICcvP3RhZz0nICsgZWxlbWVudC5pZCk7XG4gICAgICAgICQoJyMnICsgY291bnRyeUNvZGUgKyAnIC5jYXJkIC5jYXJkLWNvbnRlbnQgLmFmZmlsaWF0ZS1saXN0IC50YWJsZS1jb250ZW50JykuYXBwZW5kKHRhYmxlX2VudHJ5KTtcbiAgICAgICAgJCh0YWJsZV9lbnRyeSkuZmluZCgnLmFmZmlsaWF0ZS1yZW1vdmUnKS5jbGljayhmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIGFmZmlsaWF0ZUlkc0hhbmRsZXIucmVtb3ZlQWZmaWxpYXRlSWQoY291bnRyeUNvZGUsICQoZS5jdXJyZW50VGFyZ2V0KS5wYXJlbnQoKS5maW5kKFwiLmFmZmlsaWF0ZS1pZFwiKS50ZXh0KCkpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICB2YXIgcHJldmVudCA9IGFmZmlsaWF0ZUlkc0hhbmRsZXIuZ2V0UHJldmVudE92ZXJ3cml0ZSgpID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgJCgnI092ZXJyaWRlX1RhZycpLnByb3AoJ2NoZWNrZWQnLCBwcmV2ZW50KTtcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gT3B0aW9uc01lbnU7XG59KCk7XG5cbk9wdGlvbnNNZW51LmFzc29jaWF0ZVByb2dyYW1zID0ge1xuICAnZGUnOiB7XG4gICAgXCJuYW1lXCI6IFwid3d3LmFtYXpvbi5kZVwiLFxuICAgIFwidXJsXCI6IFwiaHR0cHM6Ly93d3cuYW1hem9uLmRlXCJcbiAgfSxcbiAgJ3VrJzoge1xuICAgIFwibmFtZVwiOiBcInd3dy5hbWF6b24uY28udWtcIixcbiAgICBcInVybFwiOiBcImh0dHBzOi8vd3d3LmFtYXpvbi5jby51a1wiXG4gIH0sXG4gICd1cyc6IHtcbiAgICBcIm5hbWVcIjogXCJ3d3cuYW1hem9uLmNvbVwiLFxuICAgIFwidXJsXCI6IFwiaHR0cHM6Ly93d3cuYW1hem9uLmNvbVwiXG4gIH0sXG4gICdmcic6IHtcbiAgICBcIm5hbWVcIjogXCJ3d3cuYW1hem9uLmZyXCIsXG4gICAgXCJ1cmxcIjogXCJodHRwczovL3d3dy5hbWF6b24uZnJcIlxuICB9LFxuICAnanAnOiB7XG4gICAgXCJuYW1lXCI6IFwid3d3LmFtYXpvbi5jby5qcFwiLFxuICAgIFwidXJsXCI6IFwiaHR0cHM6Ly93d3cuYW1hem9uLmNvLmpwXCJcbiAgfSxcbiAgJ2NhJzoge1xuICAgIFwibmFtZVwiOiBcInd3dy5hbWF6b24uY2FcIixcbiAgICBcInVybFwiOiBcImh0dHBzOi8vd3d3LmFtYXpvbi5jYVwiXG4gIH0sXG4gICdjbic6IHtcbiAgICBcIm5hbWVcIjogXCJ3d3cuYW1hem9uLmNuXCIsXG4gICAgXCJ1cmxcIjogXCJodHRwczovL3d3dy5hbWF6b24uY25cIlxuICB9LFxuICAnaXQnOiB7XG4gICAgXCJuYW1lXCI6IFwid3d3LmFtYXpvbi5pdFwiLFxuICAgIFwidXJsXCI6IFwiaHR0cHM6Ly93d3cuYW1hem9uLml0XCJcbiAgfSxcbiAgJ2VzJzoge1xuICAgIFwibmFtZVwiOiBcInd3dy5hbWF6b24uZXNcIixcbiAgICBcInVybFwiOiBcImh0dHBzOi8vd3d3LmFtYXpvbi5lc1wiXG4gIH0sXG4gICdpbic6IHtcbiAgICBcIm5hbWVcIjogXCJ3d3cuYW1hem9uLmluXCIsXG4gICAgXCJ1cmxcIjogXCJodHRwczovL3d3dy5hbWF6b24uaW5cIlxuICB9LFxuICAnYnInOiB7XG4gICAgXCJuYW1lXCI6IFwid3d3LmFtYXpvbi5jb20uYnJcIixcbiAgICBcInVybFwiOiBcImh0dHBzOi8vd3d3LmFtYXpvbi5jb20uYnJcIlxuICB9XG59O1xuXG5cbiQoZnVuY3Rpb24gKCkge1xuICB2YXIgb3B0aW9uc01lbnUgPSBuZXcgT3B0aW9uc01lbnUobmV3IEFmZmlsaWF0ZUlkc0hhbmRsZXIoY2hyb21lKSk7XG59KTsiXX0=
